// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.29.0
// source: query.sql

package db

import (
	"context"
	"database/sql"

	"github.com/AbhinavPalacharla/xtrn-personal/internal/db/models"
)

const deleteAllMCPinstances = `-- name: DeleteAllMCPinstances :exec
DELETE FROM mcp_server_instances
`

func (q *Queries) DeleteAllMCPinstances(ctx context.Context) error {
	_, err := q.db.ExecContext(ctx, deleteAllMCPinstances)
	return err
}

const deleteMCPServerInstance = `-- name: DeleteMCPServerInstance :exec
DELETE FROM mcp_server_instances
WHERE
  id = ?
`

func (q *Queries) DeleteMCPServerInstance(ctx context.Context, id string) error {
	_, err := q.db.ExecContext(ctx, deleteMCPServerInstance, id)
	return err
}

const getMCPServerImage = `-- name: GetMCPServerImage :one
SELECT
  images.id, images.slug, images.version, images.name, images.docker_image, images.type, images.oauth_provider, images.env_schema,
  providers.name as provider_name,
  providers.client_id,
  providers.client_secret
FROM
  mcp_server_images AS images
  LEFT JOIN oauth_providers AS providers ON images.oauth_provider = providers.name
WHERE
  images.id = ?
`

type GetMCPServerImageRow struct {
	ID            string
	Slug          string
	Version       int64
	Name          string
	DockerImage   string
	Type          string
	OauthProvider sql.NullString
	EnvSchema     models.EnvSchema
	ProviderName  sql.NullString
	ClientID      sql.NullString
	ClientSecret  sql.NullString
}

func (q *Queries) GetMCPServerImage(ctx context.Context, id string) (GetMCPServerImageRow, error) {
	row := q.db.QueryRowContext(ctx, getMCPServerImage, id)
	var i GetMCPServerImageRow
	err := row.Scan(
		&i.ID,
		&i.Slug,
		&i.Version,
		&i.Name,
		&i.DockerImage,
		&i.Type,
		&i.OauthProvider,
		&i.EnvSchema,
		&i.ProviderName,
		&i.ClientID,
		&i.ClientSecret,
	)
	return i, err
}

const getMCPServerInstances = `-- name: GetMCPServerInstances :many
SELECT
  inst.id as instance_id,
  inst.address,
  img.id AS image_id,
  tool.name as tool_name,
  tool.description as tool_desc,
  tool.schema as tool_schema
FROM
  mcp_server_instances inst
  LEFT JOIN mcp_server_images AS img ON inst.slug = img.slug
  AND inst.version = img.version
  LEFT JOIN mcp_server_tools as tool ON img.id = tool.image_id
`

type GetMCPServerInstancesRow struct {
	InstanceID string
	Address    string
	ImageID    sql.NullString
	ToolName   sql.NullString
	ToolDesc   sql.NullString
	ToolSchema sql.NullString
}

func (q *Queries) GetMCPServerInstances(ctx context.Context) ([]GetMCPServerInstancesRow, error) {
	rows, err := q.db.QueryContext(ctx, getMCPServerInstances)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []GetMCPServerInstancesRow
	for rows.Next() {
		var i GetMCPServerInstancesRow
		if err := rows.Scan(
			&i.InstanceID,
			&i.Address,
			&i.ImageID,
			&i.ToolName,
			&i.ToolDesc,
			&i.ToolSchema,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getMessages = `-- name: GetMessages :many
SELECT
  m.id,
  m.role,
  m.content,
  m.stop_reason,
  m.chat_id,
  treq.tool_call_id as treq_tool_call_id,
  treq.name as treq_name,
  treq.arguments as treq_args,
  tres.tool_call_id as tres_id,
  tres.name as tres_name,
  tres.content as tres_content,
  tres.is_error as tres_is_error
FROM
  messages m
  LEFT JOIN tool_call_request as treq ON treq.message_id = m.id
  LEFT JOIN tool_call_result as tres ON tres.message_id = m.id
WHERE
  chat_id = ?
`

type GetMessagesRow struct {
	ID             string
	Role           string
	Content        sql.NullString
	StopReason     sql.NullString
	ChatID         string
	TreqToolCallID sql.NullString
	TreqName       sql.NullString
	TreqArgs       sql.NullString
	TresID         sql.NullString
	TresName       sql.NullString
	TresContent    sql.NullString
	TresIsError    sql.NullBool
}

func (q *Queries) GetMessages(ctx context.Context, chatID string) ([]GetMessagesRow, error) {
	rows, err := q.db.QueryContext(ctx, getMessages, chatID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []GetMessagesRow
	for rows.Next() {
		var i GetMessagesRow
		if err := rows.Scan(
			&i.ID,
			&i.Role,
			&i.Content,
			&i.StopReason,
			&i.ChatID,
			&i.TreqToolCallID,
			&i.TreqName,
			&i.TreqArgs,
			&i.TresID,
			&i.TresName,
			&i.TresContent,
			&i.TresIsError,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getOauthTokenByProvider = `-- name: GetOauthTokenByProvider :one
SELECT
  id, refresh_token, oauth_provider
FROM
  oauth_tokens
WHERE
  oauth_tokens.oauth_provider = ?
`

func (q *Queries) GetOauthTokenByProvider(ctx context.Context, oauthProvider string) (OauthToken, error) {
	row := q.db.QueryRowContext(ctx, getOauthTokenByProvider, oauthProvider)
	var i OauthToken
	err := row.Scan(&i.ID, &i.RefreshToken, &i.OauthProvider)
	return i, err
}

const insertChat = `-- name: InsertChat :exec
/*
Chat Queries
*/
INSERT INTO
  chats (id)
VALUES
  (?)
`

// *********************************
func (q *Queries) InsertChat(ctx context.Context, id string) error {
	_, err := q.db.ExecContext(ctx, insertChat, id)
	return err
}

const insertMCPServerImage = `-- name: InsertMCPServerImage :exec
/*
MCP Server Image Queries
*/
INSERT INTO
  mcp_server_images (
    id,
    slug,
    version,
    name,
    docker_image,
    type,
    oauth_provider,
    env_schema
  )
VALUES
  (?, ?, ?, ?, ?, ?, ?, ?)
`

type InsertMCPServerImageParams struct {
	ID            string
	Slug          string
	Version       int64
	Name          string
	DockerImage   string
	Type          string
	OauthProvider sql.NullString
	EnvSchema     models.EnvSchema
}

// *********************************
func (q *Queries) InsertMCPServerImage(ctx context.Context, arg InsertMCPServerImageParams) error {
	_, err := q.db.ExecContext(ctx, insertMCPServerImage,
		arg.ID,
		arg.Slug,
		arg.Version,
		arg.Name,
		arg.DockerImage,
		arg.Type,
		arg.OauthProvider,
		arg.EnvSchema,
	)
	return err
}

const insertMCPServerInstance = `-- name: InsertMCPServerInstance :exec
/*
MCP Server Instance Queries
*/
INSERT INTO
  mcp_server_instances (id, slug, version, address, env)
VALUES
  (?, ?, ?, ?, ?)
`

type InsertMCPServerInstanceParams struct {
	ID      string
	Slug    string
	Version int64
	Address string
	Env     interface{}
}

// *********************************
func (q *Queries) InsertMCPServerInstance(ctx context.Context, arg InsertMCPServerInstanceParams) error {
	_, err := q.db.ExecContext(ctx, insertMCPServerInstance,
		arg.ID,
		arg.Slug,
		arg.Version,
		arg.Address,
		arg.Env,
	)
	return err
}

const insertMCPServerInstanceTool = `-- name: InsertMCPServerInstanceTool :exec
INSERT INTO
  mcp_server_tools (id, name, description, schema, image_id)
VALUES
  (?, ?, ?, ?, ?)
`

type InsertMCPServerInstanceToolParams struct {
	ID          string
	Name        string
	Description sql.NullString
	Schema      string
	ImageID     string
}

func (q *Queries) InsertMCPServerInstanceTool(ctx context.Context, arg InsertMCPServerInstanceToolParams) error {
	_, err := q.db.ExecContext(ctx, insertMCPServerInstanceTool,
		arg.ID,
		arg.Name,
		arg.Description,
		arg.Schema,
		arg.ImageID,
	)
	return err
}

const insertMessage = `-- name: InsertMessage :exec
INSERT INTO
  messages (id, role, content, stop_reason, chat_id)
VALUES
  (?, ?, ?, ?, ?)
`

type InsertMessageParams struct {
	ID         string
	Role       string
	Content    sql.NullString
	StopReason sql.NullString
	ChatID     string
}

func (q *Queries) InsertMessage(ctx context.Context, arg InsertMessageParams) error {
	_, err := q.db.ExecContext(ctx, insertMessage,
		arg.ID,
		arg.Role,
		arg.Content,
		arg.StopReason,
		arg.ChatID,
	)
	return err
}

const insertOauthProvider = `-- name: InsertOauthProvider :exec
/*
OAUTH token queries
*/
INSERT INTO
  oauth_providers (
    name,
    client_id,
    client_secret,
    callback_url,
    scopes
  )
VALUES
  (?, ?, ?, ?, ?)
`

type InsertOauthProviderParams struct {
	Name         string
	ClientID     string
	ClientSecret string
	CallbackUrl  string
	Scopes       sql.NullString
}

// *********************************
func (q *Queries) InsertOauthProvider(ctx context.Context, arg InsertOauthProviderParams) error {
	_, err := q.db.ExecContext(ctx, insertOauthProvider,
		arg.Name,
		arg.ClientID,
		arg.ClientSecret,
		arg.CallbackUrl,
		arg.Scopes,
	)
	return err
}

const insertOauthToken = `-- name: InsertOauthToken :exec
INSERT INTO
  oauth_tokens (id, refresh_token, oauth_provider)
VALUES
  (?, ?, ?)
`

type InsertOauthTokenParams struct {
	ID            string
	RefreshToken  string
	OauthProvider string
}

func (q *Queries) InsertOauthToken(ctx context.Context, arg InsertOauthTokenParams) error {
	_, err := q.db.ExecContext(ctx, insertOauthToken, arg.ID, arg.RefreshToken, arg.OauthProvider)
	return err
}

const insertToolCallRequest = `-- name: InsertToolCallRequest :exec
INSERT INTO
  tool_call_request (message_id, tool_call_id, name, arguments)
VALUES
  (?, ?, ?, ?)
`

type InsertToolCallRequestParams struct {
	MessageID  string
	ToolCallID string
	Name       string
	Arguments  string
}

func (q *Queries) InsertToolCallRequest(ctx context.Context, arg InsertToolCallRequestParams) error {
	_, err := q.db.ExecContext(ctx, insertToolCallRequest,
		arg.MessageID,
		arg.ToolCallID,
		arg.Name,
		arg.Arguments,
	)
	return err
}

const insertToolCallResult = `-- name: InsertToolCallResult :exec
INSERT INTO
  tool_call_result (message_id, tool_call_id, name, content, is_error)
VALUES
  (?, ?, ?, ?, ?)
`

type InsertToolCallResultParams struct {
	MessageID  string
	ToolCallID string
	Name       string
	Content    string
	IsError    bool
}

func (q *Queries) InsertToolCallResult(ctx context.Context, arg InsertToolCallResultParams) error {
	_, err := q.db.ExecContext(ctx, insertToolCallResult,
		arg.MessageID,
		arg.ToolCallID,
		arg.Name,
		arg.Content,
		arg.IsError,
	)
	return err
}

const updateOauthTokenByProivder = `-- name: UpdateOauthTokenByProivder :exec
UPDATE oauth_tokens
SET
  refresh_token = ?
WHERE
  oauth_provider = ?
`

type UpdateOauthTokenByProivderParams struct {
	RefreshToken  string
	OauthProvider string
}

func (q *Queries) UpdateOauthTokenByProivder(ctx context.Context, arg UpdateOauthTokenByProivderParams) error {
	_, err := q.db.ExecContext(ctx, updateOauthTokenByProivder, arg.RefreshToken, arg.OauthProvider)
	return err
}
